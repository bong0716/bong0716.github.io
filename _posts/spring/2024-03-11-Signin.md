---
layout: post
title: "[Spring] íšŒì›ê°€ì… ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸°(1)"
date: 2024-03-11 10:00:23 +0900
categories: "Spring"
---  
ì•„ì´í‹°ìœŒì˜ êµ­ë¹„ì§€ì› [ìŠ¤í”„ë§ë¶€íŠ¸ SNS í¬í† ê·¸ë¨ í”„ë¡œì íŠ¸] ê°•ì˜ë¥¼ ìˆ˜ê°•í•˜ë©° ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.

<br>

## ì˜¤ëŠ˜ì˜ ì‹¤ìŠµ
1. íšŒì›ê°€ì… í˜ì´ì§€ ìƒì„±
2. íšŒì›ê°€ì… DTO ìƒì„±
3. User ëª¨ë¸ ìƒì„±
4. íšŒì›ê°€ì… Repository ìƒì„±
5. íšŒì›ê°€ì… Service ìƒì„±
6. íšŒì›ê°€ì… Controller ìƒì„±



<br>

## ğŸ”ê·¸ ì „ì— ì•Œì•„ì•¼í•  ê²ƒ
---
### DTO(Data Transfer Object)ë€?
í†µì‹ í•  ë•Œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ë‹´ì•„ì£¼ëŠ” Objectì´ë‹¤.   
ì£¼ë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ê°ì²´ì™€ ë°ì´í„° ì „ì†¡ ê°ì²´ ê°„ì˜ ë³€í™˜ì„ ìœ„í•´ ì‚¬ìš©ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´, DBë¡œë¶€í„° ì¡°íšŒí•œ ì—”í‹°í‹° ê°ì²´ë¥¼ DTOë¡œ ë³€í™˜í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬í•˜ê±°ë‚˜, í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì „ë‹¬í•œ ë°ì´í„°ë¥¼ ì—”í‹°í‹° ê°ì²´ë¡œ ë³€í™˜í•˜ì—¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 

### ORM(Object-Relational Mapping)ì´ë€? 
ê¸°ìˆ ì ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê°ì²´ë¥¼ RDB í…Œì´ë¸”ì— ìë™ìœ¼ë¡œ ì˜ì†í™” í•´ì¤€ë‹¤.   
ì¦‰, ë°ì´í„°ë² ì´ìŠ¤ì™€ ì§ì ‘ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ëŒ€ì‹ , ê°ì²´ ëª¨ë¸ì„ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë‹¤. ì´ë¡œì¨ ê°œë°œìëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ êµ¬ì²´ì ì¸ êµ¬í˜„ ì„¸ë¶€ ì‚¬í•­ì„ ì‹ ê²½ ì“¸ í•„ìš” ì—†ì´ ê°ì²´ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ë°ì´í„°ë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆë‹¤.

### Hibernateì™€ JPA(Java Persistence API)ë€? 
ëŒ€í‘œì ì¸ ORM í”„ë ˆì„ì›Œí¬ë¡œ Javaì˜ Hibernateê°€ ìˆë‹¤. HibernateëŠ” JPA ìŠ¤í™ì˜ êµ¬í˜„ì²´ë¡œ, JPAë¥¼ ì‚¬ìš©í•˜ì—¬ ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤. 

<br>

## ì‹¤ìŠµ
---
**[1. íšŒì›ê°€ì… í˜ì´ì§€ ì½”ë“œ]**
```html
<body>
        <div class="login__form">
            <!--íšŒì›ê°€ì… ì¸í’‹-->
            <form class="login__input" action="/auth/signup" method="post">
                <input type="text" name="username" placeholder="ìœ ì €ë„¤ì„" required="required" maxlength="30"/>
                <input type="password" name="password" placeholder="íŒ¨ìŠ¤ì›Œë“œ" required="required" />
                <input type="email" name="email" placeholder="ì´ë©”ì¼" required="required" />
                <input type="text" name="name" placeholder="ì´ë¦„" required="required" />
                <button>ê°€ì…</button>
            </form>
            <!--íšŒì›ê°€ì… ì¸í’‹end--> 
        </div>
</body>
```
---
<br>

**[2. íšŒì›ê°€ì… DTO]**
```java
package com.cos.photogramstart.web.dto.auth;

@Data // Getterì™€ Setterë¥¼ ìƒì„±í•´ì¤Œ
public class SignupDto {
    private String username;
    private String password;
    private String email;
    private String name;

    public User toEntity() {
        return User.builder()
            .username(username)
            .password(password)
            .email(email)
            .name(name)
            .build();
    }
}
```
íšŒì›ê°€ì… í¼ì—ì„œ ì…ë ¥ëœ ì •ë³´ë¥¼ ì €ì¥í•˜ê³ , ì´ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‹¤ì œ ì‚¬ìš©ì ì—”í‹°í‹°ë¡œ ë³€í™˜í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.  

<br>

toEntity() ë©”ì„œë“œëŠ” SignupDto ê°ì²´ë¥¼ ì‹¤ì œ ì‚¬ìš©ì ì—”í‹°í‹°(User í´ë˜ìŠ¤)ë¡œ ë³€í™˜í•œë‹¤. DTOì— ì €ì¥ëœ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒˆë¡œìš´ ì‚¬ìš©ì ì—”í‹°í‹°ë¥¼ ìƒì„±í•˜ì—¬ ë°˜í™˜í•˜ë©° ì´ ë•Œ, User ì—”í‹°í‹°ì˜ ë¹Œë” íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ ì‰½ê²Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.

---
<br>

**[3. User ëª¨ë¸ ìƒì„±]**
```java
package com.cos.photogramstart.domain.user;

@Builder
@AllArgsConstructor
@NoArgsConstructor
@Data
@Entity // DBì— í…Œì´ë¸”ì„ ìƒì„±
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY) // ë²ˆí˜¸ ì¦ê°€ ì „ëµì´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë”°ë¼ê°„ë‹¤.
    private int id;

    @Column(unique = true)
    private String username;
    private String password;

    private String name;
    private String website; // ì›¹ì‚¬ì´íŠ¸
    private String bio; // ìê¸°ì†Œê°œ
    private String email;
    private String phone;
    private String gender;

    private String profileImageUrl; // ì‚¬ì§„
    private String role; // ê¶Œí•œ

    private LocalDateTime createDate;
    
    @PrePersist // DBì— Insert ë˜ê¸° ì§ì „ì— ì‹¤í–‰
    public void createDate() {
        this.createDate = LocalDateTime.now();
    }
}
```  
<span style="background-color:#9FEEC3"><strong> @Builder</strong></span> : ë””ìì¸íŒ¨í„´ ì¤‘ ë¹Œë”íŒ¨í„´ ì‚¬ìš©ì„ ìœ„í•œ ì–´ë…¸í…Œì´ì…˜    
<span style="background-color:#9FEEC3"><strong> @AllArgsConstructor</strong></span> : ëª¨ë“  ì¸ìë¥¼ ê°€ì§„ ìƒì„±ì ìƒì„±   
<span style="background-color:#9FEEC3"><strong> @NoArgsConstructor</strong></span> : ì¸ìë¥¼ ê°€ì§€ì§€ ì•Šì€ ê¸°ë³¸ ìƒì„±ì ìƒì„±   
<span style="background-color:#9FEEC3"><strong> @Entity</strong></span> : DBì— í…Œì´ë¸”ì„ ìƒì„±í•´ì¤Œ    
<span style="background-color:#9FEEC3"><strong> @Id</strong></span> : entityì— ëŒ€í•œ ì‹ë³„ì ì§€ì • (í•„ìˆ˜)    
<span style="background-color:#9FEEC3"><strong> @GeneratedValue(strategy = GenerationType.IDENTITY)</strong></span> : ìë™ ë²ˆí˜¸ ì¦ê°€(ì‚¬ìš©í•˜ëŠ” DB ì „ëµì„ ë”°ë¦„)  
<span style="background-color:#9FEEC3"><strong>@Column(unique = true)</strong></span> : ì¤‘ë³µ ë¶ˆê°€ëŠ¥    
<span style="background-color:#9FEEC3"><strong> @PrePersist</strong></span> : DBì— Insert ë˜ê¸° ì§ì „ì— ì‹¤í–‰   

---
<br>

**[4. íšŒì›ê°€ì… Repository]**
```java
package com.cos.photogramstart.domain.user;

public interface UserRepository extends JpaRepository<User, Integer>{ // Object Type : User, Primary Key Type : Integer

}
```
JpaRepositoryëŠ” Spring Data JPAì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ì ì¸ CRUD(Create, Read, Update, Delete) ê¸°ëŠ¥ì„ ì§€ì›í•œë‹¤.  

<br>

ì²« ë²ˆì§¸ ì œë„¤ë¦­ íŒŒë¼ë¯¸í„° UserëŠ” Repositoryê°€ ë‹¤ë£¨ëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤, 
ë‘ ë²ˆì§¸ ì œë„¤ë¦­ íŒŒë¼ë¯¸í„° IntegerëŠ” í•´ë‹¹ ì—”í‹°í‹°ì˜ ê¸°ë³¸ í‚¤ íƒ€ì…ì´ë‹¤. ì—¬ê¸°ì„œëŠ” User ì—”í‹°í‹°ì˜ ê¸°ë³¸ í‚¤ê°€ Integer íƒ€ì…ì¸ ê²ƒìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë‹¤.   
JpaRepositoryë¥¼ ìƒì†í•˜ë©´ ì–´ë…¸í…Œì´ì…˜ì´ ì—†ì–´ë„ IoC ë“±ë¡ì´ ìë™ìœ¼ë¡œ ëœë‹¤.   

---
<br>

**[5. íšŒì›ê°€ì… Service]**
```java
package com.cos.photogramstart.service;

@RequiredArgsConstructor
@Service // 1. IoC 2. íŠ¸ëœì­ì…˜ ê´€ë¦¬
public class AuthService {
    
    private final UserRepository userRepository;

    @Transactional
    public User íšŒì›ê°€ì…(User user) {
        // íšŒì›ê°€ì… ì§„í–‰
        User userEntity = userRepository.save(user);
        return userEntity;
    }
}
```
<span style="background-color:#9FEEC3"><strong>@RequiredArgsConstructor </strong></span> : final í•„ë“œë“¤ì˜ ìƒì„±ìë¥¼ ë§Œë“¤ì–´ ì¤€ë‹¤.    ìë°”ì—ì„œ ì „ì—­ë³€ìˆ˜ì— finalì´ ê±¸ë ¤ìˆìœ¼ë©´ ìƒì„±ì í˜¹ì€ ê°ì²´ê°€ ë§Œë“¤ì–´ì§ˆ ë•Œ ì´ˆê¸°í™”ê°€ í•„ìˆ˜ì´ë‹¤.    
<span style="background-color:#9FEEC3"><strong>@Service </strong></span> : ì„œë¹„ìŠ¤ ê³„ì¸µì˜ í´ë˜ìŠ¤ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•  ë•Œ ì‚¬ìš©í•œë‹¤.        
<span style="background-color:#9FEEC3"><strong>@Transactional </strong></span> : í•¨ìˆ˜ê°€ ì‹¤í–‰ëœ í›„ ì¢…ë£Œë  ë•Œê¹Œì§€ íŠ¸ëœì­ì…˜ ê´€ë¦¬ë¥¼ í•´ì¤€ë‹¤. Write(Insert,Update, Delete)í•  ë•Œ ë¶™ì—¬ì¤€ë‹¤. 
ë„˜ì–´ì˜¨ ë°ì´í„°ë¥¼ ë ˆí¬ì§€í† ë¦¬ì— ë„£ì€ í›„ ë„£ì–´ì§„ ê°’ì„ returní•˜ê¸° ë•Œë¬¸ì— ë³€ìˆ˜ ëª…ì„ userEntityë¡œ ì„¤ì •í–ˆë‹¤.

---
<br>

**[6. íšŒì›ê°€ì… Controller]**
```java
@RequiredArgsConstructor // final í•„ë“œ DI
@Controller
public class AuthController() {

private final AuthService authService; 

@PostMapping("/auth/signup") // ë‹¨ìˆœíˆ íšŒì›ê°€ì… í˜ì´ì§€ ì‘ë‹µ
public String signupForm() {
    return "auth/signup";
}

@PostMapping("/auth/signup") // í¼ì— ì…ë ¥ëœ ë°ì´í„°ë¥¼ ë°›ì•„ì™€ì„œ ì‘ë‹µ
public String signup(SignupDto signupDto) {
    // User <- SignupDto
    User user = signupDto.toEntity();
    authService.íšŒì›ê°€ì…(user);

    return "auth/signin";
}
}
```

<br><br>

---
íšŒì›ê°€ì… ê¸°ëŠ¥ì€ ì™„ë£Œë˜ì—ˆì§€ë§Œ í•˜ë‚˜ ë¶€ì¡±í•œ ê²Œ ìˆë‹¤. íšŒì›ê°€ì… ì‹œ ì‚¬ìš©ìì˜ ì¸ì¦ ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ë³´ê´€í•˜ê¸° ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”ê°€ í•„ìˆ˜ë¡œ ì´ë£¨ì–´ì ¸ì•¼ í•œë‹¤. ì´ëŠ” [[Spring]íšŒì›ê°€ì… ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸°(2) - ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”](https://bong0716.github.io/spring/2024/03/13/SpringSecuritySignin.html) ì°¸ê³ ! 




